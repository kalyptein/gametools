<html>
  <head>
    <title>History</title>
  </head>
  <body>
    <h1>History</h1>

    <button id="genButton" style="width:80px">Generate</button>
    <button id="rmButton" style="width:80px">Remove</button>
    <button id="nextButton" style="width:80px">Next</button>
    <button id="prevButton" style="width:80px">Previous</button>

    <p id="resultdisplay"></p>

    <table id="agesTable" style="border: 1px solid">
      <tr>
        <th style="width:30px"></th>
        <th style="width:100px; text-align: start;">Age</th>
        <th style="width:500px; text-align: start;">Description</th>
      </tr>
    </table>

    <script type="module" defer>

      import { m, d, pick, Table, tables, addElement, insertElement, getRadioSelected } from "../scripts/utils.js"
      import { history } from "./history.js"

      // get elements
      const result = document.getElementById("resultdisplay")
      const agesTable = document.getElementById("agesTable")
      // const cultureSelect = document.getElementById("culture")
      // const typeSelect = document.getElementById("nametype")
      const genButton = document.getElementById("genButton")
      const rmButton = document.getElementById("rmButton")
      const nextButton = document.getElementById("nextButton")
      const prevButton = document.getElementById("prevButton")
      var idCount = 0

      function addAge(age, refNode=undefined) {
        let tr = insertElement(agesTable, refNode, 'tr')
        tr.setAttribute('id', `tr-age-${idCount}`)

        let td = addElement(tr, 'td')
        let el = document.createElement('input')
        el.setAttribute('type', 'radio')
        el.setAttribute('id', `td-age-${idCount}`)
        el.setAttribute('parentId', `tr-age-${idCount}`)
        el.setAttribute('ageType', age.key)
        el.setAttribute('name', 'ages')
        el.setAttribute('value', '')
        td.appendChild(el)

        td = addElement(tr, 'td', age.key)
        // td.setAttibute("style", "border: 1px solid")
        td = addElement(tr, 'td', age.description)
        // td.setAttibute("style", "border: 1px solid")

        idCount += 1
      }

      // generate random age
      genButton.addEventListener('click', event => {
        let age = history.ages()
        addAge(age)

        // TODO
        // button to generate leadsTo age and append, move radio select to the new one
        // button to generate arisesFrom age and prepend, move radio select to the new one
        //
        // make the age name a dropdown so you can change what it is (update description)
        //
        // save state w/ cookie (json list?)
      })

      // remove selected age
      rmButton.addEventListener('click', event => {
        let radio = getRadioSelected('ages')
        if (radio) { agesTable.removeChild(radio.parentElement.parentElement) }
      })

      // generate leads-to age from selected age, append to selected age
      nextButton.addEventListener('click', event => {
        let radio = getRadioSelected('ages')
        if (radio) { 
          let type = radio.getAttribute('ageType')
          let age = history.leadsTo[type]()
          addAge(age, radio.parentElement.parentElement)
          // TODO insert into table, not append at end
        }
      })

      // generate arises-from age from selected age, prepend to selected age
      prevButton.addEventListener('click', event => {
        let radio = getRadioSelected('ages')
        if (radio) { 
          let type = radio.getAttribute('ageType')
          let age = history.arisesFrom[type]()
          addAge(age, radio.parentElement.parentElement)
          // TODO insert into table, not append at end
        }
      })
    </script>

  </body>
</html>
